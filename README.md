# MyEle - 仿饿了么外卖APP

基于 Android Jetpack Compose 开发的仿饿了么外卖应用，用于 AI 操作和测试。

## 特点

- 无需登录和联网，所有数据存储在本地
- 严格遵循 MVP 架构模式
- 使用 Material Design 3 设计规范
- 完整的外卖应用功能实现

## 技术栈

- Kotlin + Jetpack Compose
- MVP 架构模式
- Navigation Compose
- Gson 数据解析
- 最低 SDK: API 33 (Android 13)

## 项目结构

```
app/src/main/
├── java/com/example/eleme/
│   ├── data/              # 数据层 (Repository, CartManager)
│   ├── model/             # 数据模型
│   ├── navigation/        # 导航配置
│   ├── ui/                # UI层 (各页面 MVP 实现)
│   ├── utils/             # 工具类
│   └── MainActivity.kt
└── assets/data/           # JSON 数据文件
```

## 功能模块

- 首页：商家列表、搜索、分类导航
- 搜索：搜索推荐、历史记录、搜索结果
- 商家详情：菜品展示、购物车、收藏
- 购物车：多商家购物车管理、结算
- 订单：订单列表、订单详情、评价
- 个人中心：我的订单、地址管理、账单、设置等

## 数据说明

所有数据存储在 `app/src/main/assets/data/` 目录，采用 JSON 格式。数据围绕武汉洪山区华中师范大学周边设置，包含 **20个商家、300个商品**、地址、订单、优惠券等完整数据。

### 商家列表 (20家)
- 川香麻辣烫、老北京炸酱面、湘味轩、粤式早茶、韩式炸鸡
- 瑞幸咖啡、茶百道、蜜雪冰城、星巴克、喜茶
- **CoCo都可、麦当劳、肯德基、必胜客、海底捞火锅**
- **西贝莜面村、外婆家、黄焖鸡米饭、沙县小吃、兰州拉面**

### 商品数据
- 每个商家拥有15个特色菜品
- 总计300个商品，涵盖各类美食
- 商品包含名称、价格、规格、评分、月销量等完整信息

## 构建

1. 使用 Android Studio 打开项目
2. 等待 Gradle 同步完成
3. 运行 `./gradlew assembleDebug` 或直接点击 Run 按钮

## 图片资源

所有图片资源已配置在 `ImageUtils.kt` 中，包括：
- 商家 Logo (20个商家)
- 商品图片 (300个商品)
  - 原有40个商品：使用各自的特定图片
  - 新增260个商品：统一使用 `tongyong.png` 通用图片
- 用户头像、骑手头像等

图片文件位于 `app/src/main/res/drawable/` 目录，通过 productId 或商家名称自动匹配。

## 开发说明

项目采用严格的 MVP 架构模式，遵循以下开发规范：
- 每个页面包含 Contract、Presenter、View 三层
- 数据通过 DataRepository 统一管理
- 图片资源通过 ImageUtils 工具类加载
- 导航使用 Navigation Compose

---

**构建状态**: ✅ BUILD SUCCESSFUL

---
## 已完成的任务
1.进入红包卡券页面查看红包类型	在json文件中查看有没有打开红包卡券页面
2.在主页进入外卖列表页面，点击排序选项，选择"好评优先"。	在json中查看是否在外卖页面点击综合排序，选择了好评优先
3.进入”我的“-“我的订单-待评价”标签页。	查看是否进入我的-待评价两个页面
4.在主页顶部搜索框输入“瑞幸咖啡”并点击搜索。	查看是否输入瑞幸咖啡和点击搜索按钮
5.在首页下拉页面触发刷新，获取最新推荐内容。	查看主页是否刷新
6.进入"我的"页面，找到"我的地址"，查看已保存的地址。	查看是否进入我的页面，查看是否点击我的地址页面进入
7.打开饿了么APP，进入"我的“中”我的订单-全部"查看最新订单状态	查看是否进入我的页面，查看是否进入我的订单-全部页面
8.在”主页“搜索烤鸡，选择价格区间”0-30“	查看是否搜索烤鸡，筛选栏下面的价格区间要0-30
9.进入饿了么“我的订单-全部”页面，找到待接单的订单，点击“取消订单”并选择原因。	查看是否进入我的页面，是否选择待接单的订单，是否点击取消订单选择原因
10.打开饿了么APP，进入“我的”页面，点击右上角设置图标，找到“支付设置”并开启免密支付。	查看是否进入我的页面，设置页面，支付设置页面，开启免密支付，要检查弹窗是否有。
11.进入购物车页面，点击全选，点击一键结算	查看是否进入购物车页面，是否点击全选，是否点击一键结算进入结算页面，是否提交出现支付成功页面。
12.在“我的”页面点击“设置”-“我的”-“更换手机号”	查看是否进入我的页面，设置页面，是否进入个人资料页面，是否点击手机号栏
13.进入“我的”页面，点击设置图标，进入“消息通知设置”，关闭消息推送	查看是否进入我的页面，设置页面，消息通知设置页面，是否进入系统消息通知页面，是否出现关闭成功弹窗。
14.搜索肯德基，选择套餐加入购物车，查看可用优惠券并选择最大的，完成下单	查看是否搜索肯德基，查看商家页面是否把肯德基套餐加入购物车，查看是否使用优惠券，查看是否进入订单结算页面并支付成功。
15.进入”我的“-”我的订单“，进入”订单详情页“，找到配送中的订单，选择”联系骑手“，发送”出了什么情况，怎么还没到“	查看是否进入我的订单页面，是否选择配送中的订单，是否选择联系骑手在线联系，是否发送"出了什么情况，怎么还没到"
16.在“我的”-”全部订单“中找到麻辣烫订单，点进商家，点击右上角更多，分享给微信好友	查看是否进入全部订单，找到麻辣烫订单，进入商家详情页，是否分享到微信。
17.进入“我的”-“我的地址”管理页面，点击添加新地址，填写学校详细地址并保存。详细地址为华中师范大学元宝山学生公寓二期，姓名于骁，手机号13022222222，标签选择学校	查看是否进入我的地址页面，是否点击添加新地址，是否选择标签学校，是否详细地址为华中师范大学元宝山学生公寓二期，姓名于骁，手机号13022222222
18.进入“我的”-“我的订单”，点击“订单详情页”，选择“联系商家”发送”缺少可乐，要求退款“	是否进入我的订单-订单详情页，是否选择联系商家，是否发送”缺少可乐，要求退款“
19.在外卖页面点击"配送最快"排序，选择列表中的第一个商家并完成下单。	是否进入外卖页面，是否在综合排序中选择配送最快，是否下单商品。
20.在外卖页筛选有预约订单的商家，然后下单第一个套餐选择明天中午时间段。	是否进入外卖页面，是否在筛选中选择跨天预定，是否下单。
21.进入"我的"-"我的账单"页面，切换到"月账单"，看看本月花了多少钱。	是否进入我的-我的账单页面，是否切换到月账单。
22.进入"我的"-"我的订单-待评价"，找到已评价，删除最近的一个评价。	是否进入我的-我的订单-待评价换到已评价页面,判断是否删除评价，删除有删除成功弹窗。
23.在"我的"-"全部订单"中找到有麻辣烫的订单，进入"订单详情页"，点击申请食无忧理赔。	是否进入订单页面，是否找到麻辣烫页面，申请食无忧理赔是否申请成功。
24.在外卖页面筛选食无忧和预约配送，找一个商家给于骁和余味分别下一单明日中午到达的爆品。	是否进入外卖页面，是否筛选食无忧和预约配送，是否给于骁和余味分别下单，是否是明日到达的。
25.进入"我的"-"我的订单"，找到最新已完成订单，点击进入第一个订单详情页，查看"实付"金额明细。	是否进入全部订单页，是否点击页面第一个订单。
26.点击搜索框，在搜索历史页面找到"清除历史"按钮并点击。	是否在搜索过程页点击删除历史记录。

## 最新更新 (2025-11-06)

### 新增功能 (任务25-26)

1. **任务25: 查看订单详情**
   - 进入"我的"-"我的订单"-"全部"页面
   - 点击第一个订单进入订单详情页
   - 评估脚本: `eval_25.py`
   - 验证逻辑:
     - 检查是否进入了"我的"页面
     - 检查是否进入了"全部订单"页面
     - 检查是否点击了第一个订单进入详情页

2. **任务26: 清除搜索历史**
   - 点击搜索框进入搜索页面
   - 点击"清除历史"按钮
   - 评估脚本: `eval_26.py`
   - 验证逻辑:
     - 检查是否进入了搜索页面
     - 检查是否点击了清除历史记录按钮

### 代码改进

1. **SearchScreen日志记录增强**
   - 添加进入搜索页面的日志记录 (action: "navigate", page: "search")
   - 添加清除历史记录的日志记录 (action: "clear_search_history", page: "search")
   - 修复清除历史功能缺少日志写入的问题

---

## 历史更新 (2025-11-05)

### 新增功能 (任务21-24)

1. **任务21: 我的账单 - 月账单切换**
   - 添加进入我的账单页面的日志记录
   - 添加切换到月账单标签的日志记录
   - 评估脚本: `eval_21.py`

2. **任务22: 已评价页面 - 删除评价功能**
   - 实现完整的删除评价功能（仅记录日志，不真实删除）
   - 添加删除成功弹窗提示
   - 切换到已评价标签的日志记录
   - 新增DataRepository的deleteReview和getFilteredReviews方法
   - 新增PreferencesManager的已删除评价ID管理方法
   - 评估脚本: `eval_22.py`

3. **任务23: 订单详情 - 食无忧理赔申请**
   - 添加进入食无忧理赔页面的日志记录
   - 添加点击申请理赔的日志记录
   - 评估脚本: `eval_23.py`

4. **任务24: 结算页面 - 地址选择功能**
   - 实现地址选择功能，支持切换收货地址
   - 添加地址选择对话框组件（AddressSelectionDialog）
   - 记录切换地址和订单完成时的地址信息
   - 支持给不同收货人下单（于骁、余味等）
   - 评估脚本: `eval_24.py`

### 修复问题
- 修复Address模型字段引用错误（receiverName, receiverPhone, detailAddress）
- 统一地址信息显示格式
- 优化结算页面地址选择交互

---

## 历史更新 (2025-11-04)

### Bug修复
1. **DataRepository崩溃修复**
   - 修复Restaurant对象从JSON加载时NullPointerException错误
   - 使用自定义JSON解析逻辑，确保所有字段都有默认值
   - 避免Gson反序列化时将未定义字段设为null

### 数据记录系统
1. **ActionLogger工具类**
   - 创建统一的操作日志记录器
   - 支持记录页面导航、搜索、筛选、排序、订单操作、设置变更、购物车操作、消息发送等
   - 数据写入到`data/data/com.example.eleme/files/messages.json`
   - 为自动化测试提供验证基础

2. **检测脚本**
   - 创建eval_8.py到eval_15.py共8个检测脚本
   - 对应开发要求中的任务8-15
   - 支持通过ADB读取APP内部存储数据并验证

3. **已实现的数据记录**
   - ✅ 任务8: 搜索烤鸡并选择价格区间0-30（SearchResultScreen）
   - ✅ 任务9: 取消订单并选择原因（OrderDetailScreen）
   - ✅ 任务10: 开启免密支付（PaymentSettingsScreen）

4. **待实现的数据记录**（框架已搭建，可参考已完成任务添加）
   - 任务11: 购物车全选和结算
   - 任务12: 更换手机号
   - 任务13: 关闭消息推送
   - 任务14: 肯德基下单流程
   - 任务15: 联系骑手发送消息

---

## 历史更新 (2025-10-31)

### 主页标签优化
1. **主页标签调整**
   - 标签顺序："常点"在左侧、"推荐"在右侧（删除了"常用"页面）
   - **默认显示"推荐"页面**，显示原主页内容（服务图标、商家列表等）
   - "常点"页面显示已收藏的商家（isFavorite），带红色爱心图标
   - 两个页面均支持下拉刷新和点击跳转商家详情
   - 保持标签顺序不变但默认打开推荐页面

### Bug修复
2. **搜索过程页面商家跳转修复**
   - 修正"专属好店"列表中商家ID，使其与实际商家数据对应
   - "北京烤鸭 (华师校园店)" ID: rest_021
   - "美滋滋烤肉拌饭" ID: rest_022
   - "肯德基" ID: rest_013
   - 现在点击商家可以正确跳转到对应的商家详情页

### 数据持久化系统
1. **PreferencesManager实现**
   - 创建SharedPreferences管理器，统一管理应用持久化数据
   - 支持支付设置、通知设置、用户信息等数据的持久化存储
   - 地址增删改功能完整实现，支持新增、编辑、删除地址

### 地址管理功能增强
2. **地址保存成功提示**
   - 新增/修改地址保存后显示成功弹窗
   - 删除地址时正确调用repository删除方法
   - 地址数据持久化存储，重启应用后保持修改

### 支付设置持久化
3. **免密支付开关**
   - 支付宝免密支付和余额免密支付开关状态持久化
   - 开关切换时显示"已开启/已关闭"弹窗提示
   - 重启应用后保持上次设置状态

### 手机号修改功能
4. **完整的手机号修改流程**
   - 点击"立即修改"弹出输入框
   - 支持输入新手机号并验证
   - 修改成功后显示成功弹窗
   - 手机号数据持久化存储

### 消息通知设置完善
5. **系统消息通知管理**
   - 点击"系统消息通知"弹出确认弹窗（"关闭"/"保留重要通知"）
   - 点击"关闭"进入通知详情页，可切换"允许通知"开关
   - 开关状态持久化，重启应用保持设置

6. **横幅通知开关**
   - 饿了么内横幅通知开关状态持久化
   - 切换时显示"已打开/已关闭"提示弹窗

7. **通知栏目跳转**
   - 聊天消息、消息号、短信通知、订单交易、权益通知、服务通知、活动优惠等栏目支持点击
   - 点击后进入对应页面，显示栏目名称
   - 订阅消息管理、清空消息列表功能入口

---

## 历史更新 (2025-10-30)

### UI优化
1. **主页界面简化**
   - 移除"爆火好店 必得25元"横幅，简化页面布局
   - 移除底部导航栏的18.8价格图标，优化导航栏布局

2. **服务图标区域优化**
   - 增加美食外卖服务图标区域高度（160dp → 220dp）
   - 确保"甜品饮品"、"学生福利"等下方一排图标完整显示，无需下拉滚动

### 交互优化
6. **外卖页面筛选栏统一**
   - 将外卖页面的排序弹窗从底部弹出改为从顶部下拉
   - 价格筛选改为双向滑动条（RangeSlider），支持0-120+价格范围调节
   - 移除了自定义价格输入框和固定价格区间选项
   - 统一与搜索结果页面的交互样式，提升用户体验一致性

### 搜索功能增强
3. **搜索发现改进**
   - 搜索发现标签改为显示已有店铺名称
   - 店铺标签可点击直接搜索，快速查找商家
   - 历史搜索标签从"备注"更新为实际店铺名称

4. **专属好店交互**
   - 专属好店列表支持点击进入商家详情页
   - 优化用户浏览体验，快速访问推荐商家

### 功能页面扩展
5. **服务入口页面**
   - 为9个服务入口（超市便利、学生福利、水果买菜、看病买药、甜品饮品、天天爆红包、爆品团、赚吃货豆、0元领水果）添加跳转页面
   - 创建通用服务页面模板 `ServicePageScreen`
   - 新增路由 `Screen.ServicePage`，支持动态显示服务名称
   - 所有服务入口点击后进入对应页面，显示"该功能正在开发中..."提示

---

## 历史更新 (2025-10-29)

### Bug修复
1. **免配送费红包券显示修复**
   - 修复订单详情页中使用免配送费红包券时显示-0元的问题
   - 更新 `Coupon.calculateDiscount()` 方法，添加 `deliveryFee` 参数
   - 免配送费券现在正确显示实际的配送费金额作为优惠

### 数据扩充
2. **商家数据大幅扩充**
   - 新增10个知名商家：CoCo都可、麦当劳、肯德基、必胜客、海底捞火锅、西贝莜面村、外婆家、黄焖鸡米饭、沙县小吃、兰州拉面
   - 商家总数从10家增加到20家

3. **商品数据完善**
   - 为所有商家生成完整的15个特色菜品
   - 商品总数从40个增加到300个（20家 × 15个）
   - 新增商品统一使用 `tongyong.png` 通用图片
   - 商品类型涵盖：川菜、粤菜、湘菜、北京菜、韩餐、西餐、快餐、奶茶、咖啡、火锅、面食等各类美食

---

## 历史更新 (2025-10-28)

### 已完成功能
1. **优惠券系统** - 结算页面集成优惠券选择
   - 结算页面添加优惠券选择功能
   - 优惠券按优惠金额从高到低排序
   - 自动筛选可用优惠券（根据订单金额和适用商家）
   - 自动计算优惠后的订单总价
   - 优惠券选择弹窗UI实现

2. **已评价页面优化**
   - 移除"修改"按钮
   - 添加删除评价确认弹窗
   - 弹窗提供"删除"和"设为匿名"两个选项
   - 优化用户体验

3. **搜索历史清除确认**
   - 历史搜索清除按钮添加确认弹窗
   - 防止误操作删除历史记录

4. **订单详情页优化**
   - 减少顶部空白区域（padding 从 24dp 优化到 16dp）
   - 确保返回按钮正常工作
   - 添加详细的食无忧理赔栏（包含三个理赔选项）
   - 实现联系商家功能（底部弹窗，与联系骑手类似）
   - 待接单状态添加取消订单功能（底部弹窗，提供5个取消原因）

5. **首页交互优化**
   - 实现下拉刷新功能（手动刷新按钮）
   - 学生特价右侧三条杠添加筛选功能（筛选弹窗）

6. **筛选功能优化**
   - 价格筛选改为双向滑动条（0-120+）
   - 支持动态调整价格区间
   - 实时显示选中的价格范围

7. **地址管理完整功能**
   - 新增地址：地图显示、地址输入、门牌号、收货人、性别选择、手机号、标签选择
   - 修改地址：编辑现有地址信息，右上角删除按钮
   - 删除地址：长按地址卡片弹出删除确认弹窗
   - 地址标签：支持"家"、"公司"、"学校"三种标签
